# 12ì£¼ì°¨ ìˆ˜ì—…ë‚´ìš©

## 9ì¥ í”„ë¡œì„¸ìŠ¤ ì œì–´ (Process Control)

### 9.1 í”„ë¡œì„¸ìŠ¤ ìƒì„±

#### âœ… fork() ì‹œìŠ¤í…œ í˜¸ì¶œ

* ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤ê°€ ìì‹ ì„ ë³µì œí•˜ì—¬ ìì‹ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•¨.
* ë³µì œëŠ” ì½”ë“œ, ë°ì´í„°, í™, ìŠ¤íƒ ëª¨ë‘ ë™ì¼í•œ ìƒíƒœë¡œ ì´ë£¨ì–´ì§.
* **í˜¸ì¶œ ì‹œì ì—ëŠ” í•˜ë‚˜, ë¦¬í„´ì€ ë‘ ë²ˆ ì¼ì–´ë‚¨**

  * ìì‹ í”„ë¡œì„¸ìŠ¤: `0` ë¦¬í„´
  * ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤: ìì‹ í”„ë¡œì„¸ìŠ¤ì˜ PID ë¦¬í„´

```c
#include <sys/types.h>
#include <unistd.h>
pid_t fork(void);
```

#### ğŸ§ª ì˜ˆì œ: fork1.c

```c
printf("[%d] í”„ë¡œì„¸ìŠ¤ ì‹œì‘\n", getpid());
pid = fork();
printf("[%d] í”„ë¡œì„¸ìŠ¤ : ë¦¬í„´ê°’ %d\n", getpid(), pid);
```

**ì‹¤í–‰ ê²°ê³¼:**

* ë¶€ëª¨: `[15065] ë°˜í™˜ê°’ 15066`
* ìì‹: `[15066] ë°˜í™˜ê°’ 0`

#### ğŸ’¡ ë¶€ëª¨ì™€ ìì‹ í”„ë¡œì„¸ìŠ¤ êµ¬ë³„ ë°©ë²•

```c
if (pid == 0) {
  // ìì‹ í”„ë¡œì„¸ìŠ¤ ì½”ë“œ
} else {
  // ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤ ì½”ë“œ
}
```

#### ğŸ§ª ì˜ˆì œ: fork2.c

```c
pid = fork();
if (pid == 0)
  printf("[Child] : Hello, world pid=%d\n", getpid());
else
  printf("[Parent] : Hello, world pid=%d\n", getpid());
```

#### ğŸ§ª ì˜ˆì œ: fork3.c (ë‘ ê°œì˜ ìì‹ í”„ë¡œì„¸ìŠ¤ ìƒì„±)

```c
pid1 = fork();
if (pid1 == 0) { exit(0); }
pid2 = fork();
if (pid2 == 0) { exit(0); }
printf("[PARENT] : Hello\n");
```

* **ìƒì„±ëœ í”„ë¡œì„¸ìŠ¤ ìˆ˜:** 4ê°œ ê°€ëŠ¥ (ë¶€ëª¨, ìì‹1, ìì‹2, ìì‹1ì˜ ìì‹2)

---

### 9.1.1 ìì‹ í”„ë¡œì„¸ìŠ¤ ê¸°ë‹¤ë¦¬ê¸°

#### âœ… wait()ì™€ waitpid()

```c
#include <sys/wait.h>
pid_t wait(int *status);
pid_t waitpid(pid_t pid, int *status, int options);
```

* ìì‹ í”„ë¡œì„¸ìŠ¤ì˜ ì¢…ë£Œë¥¼ ê¸°ë‹¤ë¦¼
* ì¢…ë£Œ ì½”ë“œ í™•ì¸: `status >> 8`

#### ğŸ§ª ì˜ˆì œ: forkwait.c

```c
pid = fork();
if (pid == 0) exit(1);
child = wait(&status);
printf("ìì‹ %d ì¢…ë£Œ, ì¢…ë£Œì½”ë“œ: %d\n", child, status >> 8);
```

#### ğŸ§ª ì˜ˆì œ: waitpid.c (íŠ¹ì • ìì‹ ê¸°ë‹¤ë¦¬ê¸°)

```c
pid1 = fork();
...
waitpid(pid1, &status, 0);
```

* ìì‹ì´ ì¢…ë£Œë˜ëŠ” ìˆœì„œë¥¼ ì œì–´í•  ìˆ˜ ìˆìŒ.

---

### 9.2 í”„ë¡œê·¸ë¨ ì‹¤í–‰

#### âœ… exec() ê³„ì—´ í•¨ìˆ˜

* í˜„ì¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒˆë¡œìš´ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ì™„ì „íˆ ëŒ€ì²´í•¨
* ì„±ê³µí•˜ë©´ ë¦¬í„´í•˜ì§€ ì•ŠìŒ (main()ë¶€í„° ë‹¤ì‹œ ì‹œì‘)

```c
int execl(char *path, char *arg0, ..., NULL);
int execv(char *path, char *argv[]);
int execlp(char *file, char *arg0, ..., NULL);
int execvp(char *file, char *argv[]);
```

#### ğŸ§ª ì˜ˆì œ: execute1.c

```c
if (fork() == 0) {
  execl("/bin/echo", "echo", "hello", NULL);
  exit(1);
}
```

#### ğŸ§ª ì˜ˆì œ: execute2.c (3ê°œ ëª…ë ¹ ì‹¤í–‰)

```c
fork(); execl("/bin/echo", ...);
fork(); execl("/bin/date", ...);
fork(); execl("/bin/ls", ...);
```

#### ğŸ§ª ì˜ˆì œ: execute3.c (ëª…ë ¹ì¤„ ì¸ìˆ˜ ê¸°ë°˜ ì‹¤í–‰)

```c
execvp(argv[1], &argv[1]);
```

#### âœ… system() í•¨ìˆ˜

* ë‚´ë¶€ì ìœ¼ë¡œ fork + exec + waitpid ì‚¬ìš©
* ëª…ë ¹ ë¬¸ìì—´ì„ ì‰˜ë¡œ ë„˜ê²¨ ì‹¤í–‰

```c
int system(const char *cmd);
```

---

### 9.3 ì…ì¶œë ¥ ì¬ì§€ì •

#### âœ… dup() / dup2()

```c
int dup(int oldfd);
int dup2(int oldfd, int newfd);
```

* `dup2(fd, 1);` â†’ `stdout`ì„ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° `fd`ë¡œ ëŒ€ì²´í•¨

#### ğŸ§ª ì˜ˆì œ: redirect1.c

```c
fd = open(argv[1], ...);
dup2(fd, 1);
printf("stdout\n"); fprintf(stderr, "stderr\n");
```

* `stdout`ì€ íŒŒì¼ì— ì €ì¥, `stderr`ëŠ” ê·¸ëŒ€ë¡œ ì½˜ì†” ì¶œë ¥

#### ğŸ§ª ì˜ˆì œ: redirect2.c

```c
fork();
dup2(fd, 1);
execvp(argv[2], &argv[2]);
```

* íŠ¹ì • ëª…ë ¹ì˜ ì¶œë ¥ì„ íŒŒì¼ë¡œ ë¦¬ë””ë ‰ì…˜ ê°€ëŠ¥

---

### 9.4 í”„ë¡œì„¸ìŠ¤ ê·¸ë£¹

#### âœ… ê°œë…

* **í”„ë¡œì„¸ìŠ¤ ê·¸ë£¹:** ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ì˜ ë…¼ë¦¬ì  ë¬¶ìŒ
* **ê·¸ë£¹ ë¦¬ë”:** ìµœì´ˆ í”„ë¡œì„¸ìŠ¤ (GID == PID)

```c
pid_t getpgrp(void);
int setpgid(pid_t pid, pid_t pgid);
```

#### ğŸ§ª ì˜ˆì œ: pgrp1.c / pgrp2.c

```c
setpgid(0, 0);  // í˜„ì¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒˆë¡œìš´ ê·¸ë£¹ ë¦¬ë”ë¡œ ì„¤ì •
```

#### waitpid ì˜µì…˜ (ê·¸ë£¹ ê¸°ì¤€)

* `pid == -1` : ì„ì˜ ìì‹
* `pid == 0` : ë™ì¼ ê·¸ë£¹ ìì‹
* `pid < -1` : íŠ¹ì • ê·¸ë£¹ ìì‹ (abs(pid) ê·¸ë£¹ ID)

---

### 9.5 ì‹œìŠ¤í…œ ë¶€íŒ… ê³¼ì •

#### âœ… ì´ˆê¸° í”„ë¡œì„¸ìŠ¤ íë¦„

* **swapper**: ì»¤ë„ ë‚´ë¶€ ìŠ¤ì¼€ì¤„ëŸ¬
* **init**: `/etc/inittab` ê¸°ë°˜ ì´ˆê¸°í™”
* **getty**: ë¡œê·¸ì¸ ëŒ€ê¸°
* **login**: ì‚¬ìš©ì ì¸ì¦
* **shell**: ì‚¬ìš©ì ëª…ë ¹ ìˆ˜ì‹ 

---

### ğŸ¯ í•µì‹¬ ìš”ì•½

* `fork()`: ë¶€ëª¨ë¥¼ ë³µì œí•´ ìì‹ í”„ë¡œì„¸ìŠ¤ ìƒì„±
* `exec()`: í˜„ì¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒˆë¡œìš´ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ëŒ€ì²´
* `wait()/waitpid()`: ìì‹ ì¢…ë£Œ ëŒ€ê¸° ë° ì¢…ë£Œ ì½”ë“œ í™•ì¸
* `dup2()`: í‘œì¤€ ì¶œë ¥ ë“± ì…ì¶œë ¥ ë¦¬ë””ë ‰ì…˜
* `system()`: ë¬¸ìì—´ ëª…ë ¹ ì‹¤í–‰ (ë‚´ë¶€ì ìœ¼ë¡œ fork + exec + wait)
* `setpgid()`: í”„ë¡œì„¸ìŠ¤ ê·¸ë£¹ ì„¤ì •
* **ë¶€íŒ… ì‹œ í”„ë¡œì„¸ìŠ¤ íë¦„ì€ init â†’ getty â†’ login â†’ shell**

<!--
chat9.pdf (09ì•„ë‹˜)

https://www.duckdns.org/domains - ê¹ƒí—™ìœ¼ë¡œ ë¡œê·¸ì¸ í•¨
ã„´ ë„ë©”ì¸ ë¬´ë£Œ í˜¸ìŠ¤íŒ…
-->